# Azure Functions Input Binding for JWT Tokens

This is an Azure Functions binding validating JWT Tokens for HTTP Triggered Azure Functions.

[![Code Smells](https://sonarcloud.io/api/project_badges/measure?project=nikneem_azure-functions-jwt-binding&metric=code_smells)](https://sonarcloud.io/dashboard?id=nikneem_azure-functions-jwt-binding)
[![Quality Gate Status](https://sonarcloud.io/api/project_badges/measure?project=nikneem_azure-functions-jwt-binding&metric=alert_status)](https://sonarcloud.io/dashboard?id=nikneem_azure-functions-jwt-binding)
[![Reliability Rating](https://sonarcloud.io/api/project_badges/measure?project=nikneem_azure-functions-jwt-binding&metric=reliability_rating)](https://sonarcloud.io/dashboard?id=nikneem_azure-functions-jwt-binding)
[![Security Rating](https://sonarcloud.io/api/project_badges/measure?project=nikneem_azure-functions-jwt-binding&metric=security_rating)](https://sonarcloud.io/dashboard?id=nikneem_azure-functions-jwt-binding)
[![Technical Debt](https://sonarcloud.io/api/project_badges/measure?project=nikneem_azure-functions-jwt-binding&metric=sqale_index)](https://sonarcloud.io/dashboard?id=nikneem_azure-functions-jwt-binding)
[![Vulnerabilities](https://sonarcloud.io/api/project_badges/measure?project=nikneem_azure-functions-jwt-binding&metric=vulnerabilities)](https://sonarcloud.io/dashboard?id=nikneem_azure-functions-jwt-binding)

## Support & Usage
The binding is only tested on ASP.NET Core 3.1 Azure Functions with the Azure Functions v3.

[Find this package on NuGet](https://www.nuget.org/packages/HexMaster.Functions.JwtBinding/)  

Package Manager  
`Install-Package HexMaster.Functions.JwtBinding`

.NET CLI  
`dotnet add package HexMaster.Functions.JwtBinding`

## Validating tokens
Let's say you run a SPA in which you want users to log in. You'll probably end up with a JWT token (or Access Token if you like). But now, you want to call a backend system, and pass that token so your backend can verify and identify the user. In conventional ASP.NET Core projects, you can add token validation to the request pipeline. In Azure Functions you can not. And this is where the binding kicks in. You need to, _manually_, validate the token and verify the caller's identity. And I thought is was a good idea to create a custom binding validating the token and -in the end- make sure who calls our functions.

### Usage
To use the token binding, simply add an `AuthorizedModel` parameter to your function with the `JwtBinding` attribute and you're good to go.

```csharp
[JwtBinding] AuthorizedModel auth
```

### Options
With JWT Tokens you really want to validate some extra stuff before just accepting the request. The binding uses the [JwtSecurityTokenHandler ](https://docs.microsoft.com/en-us/dotnet/api/system.identitymodel.tokens.jwt.jwtsecuritytokenhandler?view=azure-dotnet&WT.mc_id=AZ-MVP-5003924) class under the hood, which takes care of some validations for us. Not all of them however.

### Issuer and Audiences
You may want to validate the Issuer and/or Audience of the token.

Issuer check means
- Check if the token is generated by the provider that I expect

Audience check
- Check if the called is allowed to access this API

If you use the JwtBinding attribute without parameters, neither one of these checks are done. However, you can pass the issuer and audience as a parameter to the `JwtBindingAttribute` like so:
```csharp
[JwtBinding("%JwtBinding:Issuer%", "%JwtBinding:Audience%")] AuthorizedModel auth
```

Note `%JwtBinding:Issuer%` is a reference to the configuration of your Azure Function. Make sure the configuration values exist. To run your function locally, add the following to the values section in your `local.settings.json`

```json
"JwtBinding:Audience": "your-audience",
"JwtBinding:Issuer": "https://your-token-provider.com"
```
